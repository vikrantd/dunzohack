{"version":3,"sources":["../../../modules/entity/src/entity_state.ts","../../../modules/entity/src/state_selectors.ts","../../../modules/entity/src/state_adapter.ts","../../../modules/entity/src/unsorted_state_adapter.ts","../../../modules/entity/src/sorted_state_adapter.ts","../../../modules/entity/src/create_adapter.ts"],"names":["getInitialEntityState","ids","entities","createInitialStateFactory","getInitialState","additionalState","Object","assign","createSelectorsFactory","getSelectors","selectState","selectIds","state","selectEntities","selectAll","createSelector","map","id","selectTotal","length","createStateOperator","mutator","arg","clonedEntityState","slice","createUnsortedStateAdapter","selectId","addOneMutably","entity","key","push","addManyMutably","didMutate","index","addAllMutably","removeOneMutably","removeManyMutably","keys","filter","removeAll","takeNewKey","update","original","updated","changes","newKey","updateOneMutably","updateManyMutably","updates","newKeys","addOne","addMany","addAll","updateOne","updateMany","removeOne","removeMany","createSortedStateAdapter","sort","newModels","merge","model","models","takeUpdatedModel","forEach","i","j","modelId","entityId","concat","_a","createEntityAdapter","options","sortComparer","instance","stateFactory","selectorsFactory","stateAdapter"],"mappings":"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","file":"./dist/entity/bundles/entity.umd.min.js","sourcesContent":["import { EntityState } from './models';\n/**\n * @template V\n * @return {?}\n */\nexport function getInitialEntityState<V>(): EntityState<V> {\n  return {\n    ids: [],\n    entities: {},\n  };\n}\n/**\n * @template V\n * @return {?}\n */\nexport function createInitialStateFactory<V>() {\n  function getInitialState(): EntityState<V>;\n  function getInitialState<S extends object>(\n    additionalState: S\n  ): EntityState<V> & S;\n/**\n * @param {?=} additionalState\n * @return {?}\n */\nfunction getInitialState(additionalState: any = {}): any {\n    return Object.assign(getInitialEntityState(), additionalState);\n  }\n\n  return { getInitialState };\n}\n","import { createSelector } from '@ngrx/store';\nimport { EntityState, EntitySelectors, Dictionary } from './models';\n/**\n * @template T\n * @return {?}\n */\nexport function createSelectorsFactory<T>() {\n  function getSelectors(): EntitySelectors<T, EntityState<T>>;\n  function getSelectors<V>(\n    selectState: (state: V) => EntityState<T>\n  ): EntitySelectors<T, V>;\n/**\n * @param {?=} selectState\n * @return {?}\n */\nfunction getSelectors(\n    selectState?: (state: any) => EntityState<T>\n  ): EntitySelectors<T, any> {\n    const /** @type {?} */ selectIds = (state: any) => state.ids;\n    const /** @type {?} */ selectEntities = (state: EntityState<T>) => state.entities;\n    const /** @type {?} */ selectAll = createSelector(\n      selectIds,\n      selectEntities,\n      (ids: T[], entities: Dictionary<T>): any =>\n        ids.map((id: any) => ( /** @type {?} */((entities as any)))[id])\n    );\n\n    const /** @type {?} */ selectTotal = createSelector(selectIds, ids => ids.length);\n\n    if (!selectState) {\n      return {\n        selectIds,\n        selectEntities,\n        selectAll,\n        selectTotal,\n      };\n    }\n\n    return {\n      selectIds: createSelector(selectState, selectIds),\n      selectEntities: createSelector(selectState, selectEntities),\n      selectAll: createSelector(selectState, selectAll),\n      selectTotal: createSelector(selectState, selectTotal),\n    };\n  }\n\n  return { getSelectors };\n}\n","import { EntityState, EntityStateAdapter } from './models';\n\nexport function createStateOperator<V, R>(\n  mutator: (arg: R, state: EntityState<V>) => boolean\n): EntityState<V>;\n/**\n * @template V, R\n * @param {?} mutator\n * @return {?}\n */\nexport function createStateOperator<V, R>(\n  mutator: (arg: any, state: any) => boolean\n): any {\n  return function operation<S extends EntityState<V>>(arg: R, state: any): S {\n    const /** @type {?} */ clonedEntityState: EntityState<V> = {\n      ids: [...state.ids],\n      entities: { ...state.entities },\n    };\n\n    const /** @type {?} */ didMutate = mutator(arg, clonedEntityState);\n\n    if (didMutate) {\n      return Object.assign({}, state, clonedEntityState);\n    }\n\n    return state;\n  };\n}\n","import { EntityState, EntityStateAdapter, IdSelector, Update } from './models';\nimport { createStateOperator } from './state_adapter';\n\nexport function createUnsortedStateAdapter<T>(\n  selectId: IdSelector<T>\n): EntityStateAdapter<T>;\n/**\n * @template T\n * @param {?} selectId\n * @return {?}\n */\nexport function createUnsortedStateAdapter<T>(selectId: IdSelector<T>): any {\n  type R = EntityState<T>;\n\n  function addOneMutably(entity: T, state: R): boolean;\n/**\n * @param {?} entity\n * @param {?} state\n * @return {?}\n */\nfunction addOneMutably(entity: any, state: any): boolean {\n    const /** @type {?} */ key = selectId(entity);\n\n    if (key in state.entities) {\n      return false;\n    }\n\n    state.ids.push(key);\n    state.entities[key] = entity;\n\n    return true;\n  }\n\n  function addManyMutably(entities: T[], state: R): boolean;\n/**\n * @param {?} entities\n * @param {?} state\n * @return {?}\n */\nfunction addManyMutably(entities: any[], state: any): boolean {\n    let /** @type {?} */ didMutate = false;\n\n    for (let /** @type {?} */ index in entities) {\n      didMutate = addOneMutably(entities[index], state) || didMutate;\n    }\n\n    return didMutate;\n  }\n\n  function addAllMutably(entities: T[], state: R): boolean;\n/**\n * @param {?} entities\n * @param {?} state\n * @return {?}\n */\nfunction addAllMutably(entities: any[], state: any): boolean {\n    state.ids = [];\n    state.entities = {};\n\n    addManyMutably(entities, state);\n\n    return true;\n  }\n\n  function removeOneMutably(key: T, state: R): boolean;\n/**\n * @param {?} key\n * @param {?} state\n * @return {?}\n */\nfunction removeOneMutably(key: any, state: any): boolean {\n    return removeManyMutably([key], state);\n  }\n\n  function removeManyMutably(keys: T[], state: R): boolean;\n/**\n * @param {?} keys\n * @param {?} state\n * @return {?}\n */\nfunction removeManyMutably(keys: any[], state: any): boolean {\n    const /** @type {?} */ didMutate =\n      keys\n        .filter(key => key in state.entities)\n        .map(key => delete state.entities[key]).length > 0;\n\n    if (didMutate) {\n      state.ids = state.ids.filter((id: any) => id in state.entities);\n    }\n\n    return didMutate;\n  }\n\n  function removeAll<S extends R>(state: S): S;\n/**\n * @template S\n * @param {?} state\n * @return {?}\n */\nfunction removeAll<S extends R>(state: any): S {\n    return Object.assign({}, state, {\n      ids: [],\n      entities: {},\n    });\n  }\n\n  function takeNewKey(\n    keys: { [id: string]: string },\n    update: Update<T>,\n    state: R\n  ): void;\n/**\n * @param {?} keys\n * @param {?} update\n * @param {?} state\n * @return {?}\n */\nfunction takeNewKey(\n    keys: { [id: string]: any },\n    update: Update<T>,\n    state: any\n  ): void {\n    const /** @type {?} */ original = state.entities[update.id];\n    const /** @type {?} */ updated: T = Object.assign({}, original, update.changes);\n    const /** @type {?} */ newKey = selectId(updated);\n\n    if (newKey !== update.id) {\n      keys[update.id] = newKey;\n      delete state.entities[update.id];\n    }\n\n    state.entities[newKey] = updated;\n  }\n\n  function updateOneMutably(update: Update<T>, state: R): boolean;\n/**\n * @param {?} update\n * @param {?} state\n * @return {?}\n */\nfunction updateOneMutably(update: any, state: any): boolean {\n    return updateManyMutably([update], state);\n  }\n\n  function updateManyMutably(updates: Update<T>[], state: R): boolean;\n/**\n * @param {?} updates\n * @param {?} state\n * @return {?}\n */\nfunction updateManyMutably(updates: any[], state: any): boolean {\n    const /** @type {?} */ newKeys: { [id: string]: string } = {};\n\n    const /** @type {?} */ didMutate =\n      updates\n        .filter(update => update.id in state.entities)\n        .map(update => takeNewKey(newKeys, update, state)).length > 0;\n\n    if (didMutate) {\n      state.ids = state.ids.map((id: any) => newKeys[id] || id);\n    }\n\n    return didMutate;\n  }\n\n  return {\n    removeAll,\n    addOne: createStateOperator(addOneMutably),\n    addMany: createStateOperator(addManyMutably),\n    addAll: createStateOperator(addAllMutably),\n    updateOne: createStateOperator(updateOneMutably),\n    updateMany: createStateOperator(updateManyMutably),\n    removeOne: createStateOperator(removeOneMutably),\n    removeMany: createStateOperator(removeManyMutably),\n  };\n}\n","import {\n  EntityState,\n  IdSelector,\n  Comparer,\n  Dictionary,\n  EntityStateAdapter,\n  Update,\n} from './models';\nimport { createStateOperator } from './state_adapter';\nimport { createUnsortedStateAdapter } from './unsorted_state_adapter';\n\nexport function createSortedStateAdapter<T>(\n  selectId: IdSelector<T>,\n  sort: Comparer<T>\n): EntityStateAdapter<T>;\n/**\n * @template T\n * @param {?} selectId\n * @param {?} sort\n * @return {?}\n */\nexport function createSortedStateAdapter<T>(selectId: any, sort: any): any {\n  type R = EntityState<T>;\n\n  const { removeOne, removeMany, removeAll } = createUnsortedStateAdapter(\n    selectId\n  );\n\n  function addOneMutably(entity: T, state: R): boolean;\n/**\n * @param {?} entity\n * @param {?} state\n * @return {?}\n */\nfunction addOneMutably(entity: any, state: any): boolean {\n    return addManyMutably([entity], state);\n  }\n\n  function addManyMutably(newModels: T[], state: R): boolean;\n/**\n * @param {?} newModels\n * @param {?} state\n * @return {?}\n */\nfunction addManyMutably(newModels: any[], state: any): boolean {\n    const /** @type {?} */ models = newModels.filter(\n      model => !(selectId(model) in state.entities)\n    );\n\n    return merge(models, state);\n  }\n\n  function addAllMutably(models: T[], state: R): boolean;\n/**\n * @param {?} models\n * @param {?} state\n * @return {?}\n */\nfunction addAllMutably(models: any[], state: any): boolean {\n    state.entities = {};\n    state.ids = [];\n\n    addManyMutably(models, state);\n\n    return true;\n  }\n\n  function updateOneMutably(update: Update<T>, state: R): boolean;\n/**\n * @param {?} update\n * @param {?} state\n * @return {?}\n */\nfunction updateOneMutably(update: any, state: any): boolean {\n    return updateManyMutably([update], state);\n  }\n\n  function takeUpdatedModel(models: T[], update: Update<T>, state: R): void;\n/**\n * @param {?} models\n * @param {?} update\n * @param {?} state\n * @return {?}\n */\nfunction takeUpdatedModel(models: any[], update: any, state: any): void {\n    if (!(update.id in state.entities)) {\n      return;\n    }\n\n    const /** @type {?} */ original = state.entities[update.id];\n    const /** @type {?} */ updated = Object.assign({}, original, update.changes);\n\n    delete state.entities[update.id];\n\n    models.push(updated);\n  }\n\n  function updateManyMutably(updates: Update<T>[], state: R): boolean;\n/**\n * @param {?} updates\n * @param {?} state\n * @return {?}\n */\nfunction updateManyMutably(updates: any[], state: any): boolean {\n    const /** @type {?} */ models: T[] = [];\n\n    updates.forEach(update => takeUpdatedModel(models, update, state));\n\n    if (models.length) {\n      state.ids = state.ids.filter((id: any) => id in state.entities);\n    }\n\n    return merge(models, state);\n  }\n\n  function merge(models: T[], state: R): boolean;\n/**\n * @param {?} models\n * @param {?} state\n * @return {?}\n */\nfunction merge(models: any[], state: any): boolean {\n    if (models.length === 0) {\n      return false;\n    }\n\n    models.sort(sort);\n\n    const /** @type {?} */ ids: any[] = [];\n\n    let /** @type {?} */ i = 0;\n    let /** @type {?} */ j = 0;\n\n    while (i < models.length && j < state.ids.length) {\n      const /** @type {?} */ model = models[i];\n      const /** @type {?} */ modelId = selectId(model);\n      const /** @type {?} */ entityId = state.ids[j];\n      const /** @type {?} */ entity = state.entities[entityId];\n\n      if (sort(model, entity) <= 0) {\n        ids.push(modelId);\n        i++;\n      } else {\n        ids.push(entityId);\n        j++;\n      }\n    }\n\n    if (i < models.length) {\n      state.ids = ids.concat(models.slice(i).map(selectId));\n    } else {\n      state.ids = ids.concat(state.ids.slice(j));\n    }\n\n    models.forEach((model, i) => {\n      state.entities[selectId(model)] = model;\n    });\n\n    return true;\n  }\n\n  return {\n    removeOne,\n    removeMany,\n    removeAll,\n    addOne: createStateOperator(addOneMutably),\n    updateOne: createStateOperator(updateOneMutably),\n    addAll: createStateOperator(addAllMutably),\n    addMany: createStateOperator(addManyMutably),\n    updateMany: createStateOperator(updateManyMutably),\n  };\n}\n","import { createSelector } from '@ngrx/store';\nimport {\n  EntityDefinition,\n  Comparer,\n  IdSelector,\n  EntityAdapter,\n} from './models';\nimport { createInitialStateFactory } from './entity_state';\nimport { createSelectorsFactory } from './state_selectors';\nimport { createSortedStateAdapter } from './sorted_state_adapter';\nimport { createUnsortedStateAdapter } from './unsorted_state_adapter';\n/**\n * @template T\n * @param {?=} options\n * @return {?}\n */\nexport function createEntityAdapter<T>(\n  options: {\n    selectId?: IdSelector<T>;\n    sortComparer?: false | Comparer<T>;\n  } = {}\n): EntityAdapter<T> {\n  const { selectId, sortComparer }: EntityDefinition<T> = {\n    sortComparer: false,\n    selectId: (instance: any) => instance.id,\n    ...options,\n  };\n\n  const /** @type {?} */ stateFactory = createInitialStateFactory<T>();\n  const /** @type {?} */ selectorsFactory = createSelectorsFactory<T>();\n  const /** @type {?} */ stateAdapter = sortComparer\n    ? createSortedStateAdapter(selectId, sortComparer)\n    : createUnsortedStateAdapter(selectId);\n\n  return {\n    ...stateFactory,\n    ...selectorsFactory,\n    ...stateAdapter,\n  };\n}\n"]}